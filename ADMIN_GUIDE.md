# Admin Panel Guide

This guide explains how to use the admin panel for the Football Betting Analysis application.

## Overview

The admin panel provides both a web interface and REST API for managing all aspects of the application, including:
- User management (both admin users and Telegram users)
- League and team data
- Match information
- Betting opportunities
- Notification logs

## Access

- **Web Dashboard**: `http://localhost:8000/football/api/v1/admin/dashboard`
- **API Endpoints**: `http://localhost:8000/football/api/v1/admin/`

## Default Credentials

On first startup, a default admin user is created:
- **Username**: `admin`
- **Password**: `admin123`

**⚠️ IMPORTANT**: Change the default password immediately in production!

## Features

### 1. Authentication
- Secure login system with JWT tokens
- Session-based authentication for the web interface
- Password hashing with bcrypt
- User role management (regular admin vs superuser)

### 2. User Management
- Create, read, update, delete admin users
- Role-based access control
- Password change functionality
- User activity tracking

### 3. Data Management
The admin panel provides full CRUD operations for:

#### Leagues
- View and manage football leagues
- Add new leagues with country information
- Search and filter leagues

#### Teams
- Manage team information
- View team statistics (wins, draws, losses, points)
- Team ranking and performance data

#### Matches
- View all matches
- Match status tracking (scheduled, live, finished)
- Score management
- Match date and round information

#### Betting Opportunities
- Monitor betting opportunities generated by the system
- View confidence scores and rule details
- Track opportunity outcomes
- Filter by rule type and status

#### Telegram Users
- Manage bot users
- View user preferences (notifications settings)
- User activity and engagement tracking

#### Notification Logs
- Monitor notification delivery
- Track success/failure rates
- Debug notification issues

## API Endpoints

The admin system also provides REST API endpoints for programmatic access:

### Authentication
- `POST /football/api/v1/admin/login` - Login and get JWT token
- `GET /football/api/v1/admin/me` - Get current user info

### User Management (Superuser only)
- `POST /football/api/v1/admin/users` - Create new admin user
- `GET /football/api/v1/admin/users` - List all admin users
- `GET /football/api/v1/admin/users/{id}` - Get specific user
- `PUT /football/api/v1/admin/users/{id}` - Update user
- `DELETE /football/api/v1/admin/users/{id}` - Delete user

### Password Management
- `POST /football/api/v1/admin/change-password` - Change current user password

## Security Features

1. **Password Security**
   - Passwords are hashed using bcrypt
   - Strong password requirements
   - Password change functionality

2. **Access Control**
   - Role-based permissions (admin vs superuser)
   - JWT token authentication for API
   - Session-based authentication for web interface

3. **Session Management**
   - Secure session handling
   - Token expiration
   - Logout functionality

## Configuration

Admin settings can be configured in `app/settings.py`:

```python
# Admin Configuration
admin_secret_key: str = "your-secret-key-change-in-production"
admin_session_secret: str = "your-session-secret-change-in-production"
admin_token_expire_minutes: int = 30
```

## Development

### Running Tests
```bash
pytest app/admin/admin_tests.py -v
```

### Adding New Admin Features
1. Create new models in `app/admin/models.py`
2. Add views in `app/admin/starlette_admin_config.py`
3. Create API endpoints in `app/admin/routes.py`
4. Add tests in `app/admin/admin_tests.py`

## Production Considerations

1. **Change Default Credentials**
   - Update default admin password
   - Create additional admin users
   - Remove or disable default account if needed

2. **Security Settings**
   - Use strong, unique secret keys
   - Configure proper session secrets
   - Set appropriate token expiration times

3. **Database Security**
   - Ensure database is properly secured
   - Use connection pooling
   - Regular backups

4. **Access Control**
   - Limit admin access to trusted networks
   - Use HTTPS in production
   - Monitor admin activity

## Troubleshooting

### Common Issues

1. **Cannot Access Admin Panel**
   - Check if the application is running
   - Verify the URL: `http://localhost:8000/admin`
   - Check application logs for errors

2. **Login Issues**
   - Verify username and password
   - Check if user account is active
   - Check database connection

3. **Permission Errors**
   - Ensure user has appropriate role (superuser for user management)
   - Check user account status

### Logs
Check application logs for detailed error information:
```bash
# Application logs will show admin-related activities
tail -f logs/app.log
```

## Support

For issues or questions about the admin panel:
1. Check the application logs
2. Review the test cases for expected behavior
3. Verify database connectivity
4. Check user permissions and roles
